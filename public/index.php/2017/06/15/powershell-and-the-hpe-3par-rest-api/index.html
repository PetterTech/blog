<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Powershell and the HPE 3PAR REST API | PetterTech</title>
<meta name="keywords" content="3PAR, boot lun, HPE 3PAR, Invoke-RestMethod, Powershell, REST">
<meta name="description" content="Lately, I‚Äôve had the pleasure of using Powershell to automate some of the basic tasks we do on our HPE 3PAR systems: creating volumes, adding them to volume sets, exporting them and so on.
Since my experience with REST APIs was rather limited it was quite daunting at first but once you get the hang of how REST works and the Invoke-RestMethod cmdlet it‚Äôs really not that bad.
Disclaimer: The examples below will vary somewhat in how I do certain things, simply because I had to learn all this from scratch.">
<meta name="author" content="nerenther">
<link rel="canonical" href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/index.php/2017/06/15/powershell-and-the-hpe-3par-rest-api/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bf5f9f73cf17311d52cedbcda82c922e91b2f566d88a85ad9f5b5a08b586bd5f.css" integrity="sha256-v1&#43;fc88XMR1SztvNqCySLpGy9WbYioWtn1taCLWGvV8=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/apple-touch-icon.png">
<link rel="mask-icon" href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Powershell and the HPE 3PAR REST API" />
<meta property="og:description" content="Lately, I‚Äôve had the pleasure of using Powershell to automate some of the basic tasks we do on our HPE 3PAR systems: creating volumes, adding them to volume sets, exporting them and so on.
Since my experience with REST APIs was rather limited it was quite daunting at first but once you get the hang of how REST works and the Invoke-RestMethod cmdlet it‚Äôs really not that bad.
Disclaimer: The examples below will vary somewhat in how I do certain things, simply because I had to learn all this from scratch." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/index.php/2017/06/15/powershell-and-the-hpe-3par-rest-api/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-15T12:01:01+00:00" />
<meta property="article:modified_time" content="2017-06-15T12:01:01+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Powershell and the HPE 3PAR REST API"/>
<meta name="twitter:description" content="Lately, I‚Äôve had the pleasure of using Powershell to automate some of the basic tasks we do on our HPE 3PAR systems: creating volumes, adding them to volume sets, exporting them and so on.
Since my experience with REST APIs was rather limited it was quite daunting at first but once you get the hang of how REST works and the Invoke-RestMethod cmdlet it‚Äôs really not that bad.
Disclaimer: The examples below will vary somewhat in how I do certain things, simply because I had to learn all this from scratch."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Powershell and the HPE 3PAR REST API",
      "item": "https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/index.php/2017/06/15/powershell-and-the-hpe-3par-rest-api/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Powershell and the HPE 3PAR REST API",
  "name": "Powershell and the HPE 3PAR REST API",
  "description": "Lately, I‚Äôve had the pleasure of using Powershell to automate some of the basic tasks we do on our HPE 3PAR systems: creating volumes, adding them to volume sets, exporting them and so on.\nSince my experience with REST APIs was rather limited it was quite daunting at first but once you get the hang of how REST works and the Invoke-RestMethod cmdlet it‚Äôs really not that bad.\nDisclaimer: The examples below will vary somewhat in how I do certain things, simply because I had to learn all this from scratch.",
  "keywords": [
    "3PAR", "boot lun", "HPE 3PAR", "Invoke-RestMethod", "Powershell", "REST"
  ],
  "articleBody": "Lately, I‚Äôve had the pleasure of using Powershell to automate some of the basic tasks we do on our HPE 3PAR systems: creating volumes, adding them to volume sets, exporting them and so on.\nSince my experience with REST APIs was rather limited it was quite daunting at first but once you get the hang of how REST works and the Invoke-RestMethod cmdlet it‚Äôs really not that bad.\nDisclaimer: The examples below will vary somewhat in how I do certain things, simply because I had to learn all this from scratch. Hence, the first examples will sometimes do things ‚Äúless correct‚Äù than the later examples since this also was quite the learning curve for me.\nThe first step in doing anything with the REST API will always be to create a session key. If you‚Äôre not familiar with APIs, think of a session key as username and password combined into one string. You will need to add the session key to every REST call you do later on in order to authenticate yourself.\nTo create a session key from powershell you can use the following line:\nThis will store you session key in the $key variable which you will need to add to the header of future REST calls.\nKeep in mind that each session key is valid for 15 minutes by default, but you should always delete it after each use.\nTo delete a session key you can use the following line, given that your key is still stored in $key:\nNow that you have your session key you can start to do some more interesting stuff, like creating a volume:\nThe above example will create a datastore named ‚Äú3parDatastore01‚Äù in the cpg named ‚ÄúSSD_r5‚Äù with 2TB of space and dedupe enabled. As you can see our session key is passed in the header as¬†X-HP3PAR-WSAPI-SessionKey.\nIf your well versed in JSON and powershell you can probably tell that I‚Äôm not üôÇ\nThe body you‚Äôre sending in the REST call is supposed to be formatted as a JSON object and in the above example I‚Äôm creating the JSON object manually by building it up as a string. In a later example I‚Äôll show a more ‚Äúcorrect‚Äù way to do it.\nThe next step will usually be to export the volume or to add it to a volume set. Let‚Äôs look at an example where I add a volume to an existing volume set:\nAgain, I‚Äôm building the JSON object as a string here instead of doing it the correct way.\nThe above example will add the volume called ‚Äú3parDatastore01‚Äù (which we created in the previous example) to the existing volumeset called ‚ÄútestVVSet‚Äù. If you already have exported the volume set to a host or host set it is now available for the host(s) to use.\nThe next step for me now was to query the created volume since I had to find the wwn of the volume. There are two ways I have done this: By querying all volumes and by querying a single volume.\nTo query all volumes you can use this line:\nTo query a single volume you can use this line:\nYou can also build a query directly in the uri you‚Äôre accessing by adding ?query=‚Äù‚Äù after /volumes. Here‚Äôs an example from HPE‚Äôs own guide:\nOf course, you can also do filtering in powershell if you‚Äôre more comfortable with that (I know I am) but then you will have wasted computing power on both the SAN and the machine you‚Äôre running powershell on üòâ\nIf you are not using volume sets and exporting those to hosts, the next logical step would be to export the newly created volume to a host or hostset. To export a volume to a single host you can do something like this:\nNotice the difference in the way I format the body? This is the more correct way to do it, creating a hashtable and converting it to JSON with ConvertTo-Json.\nI also create the header before the Invoke-RestMethod line here.\nThe example above will export¬†3parDatastore01 to esx01 with a lun id of 255.\nLastly, I would like to provide you with an example on how we create our boot luns. This is an extract of a powershell function I wrote, in the original function there‚Äôs a lot more automation, error handling and logging but I removed it here for the sake of readability.\nThe key thing here is the policy (oneHost) that we set on the volume when we create it. This prevents the bootlun being exported to additional hosts.\nSources:\nHPE 3PAR API doc:¬†http://h20564.www2.hpe.com/hpsc/doc/public/display?docId=c03606339\n",
  "wordCount" : "767",
  "inLanguage": "en",
  "datePublished": "2017-06-15T12:01:01Z",
  "dateModified": "2017-06-15T12:01:01Z",
  "author":{
    "@type": "Person",
    "name": "nerenther"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/index.php/2017/06/15/powershell-and-the-hpe-3par-rest-api/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PetterTech",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net" accesskey="h" title="PetterTech (Alt + H)">PetterTech</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Powershell and the HPE 3PAR REST API
    </h1>
    <div class="post-meta"><span title='2017-06-15 12:01:01 +0000 +0000'>June 15, 2017</span>&nbsp;¬∑&nbsp;nerenther

</div>
  </header> 
  <div class="post-content"><p>Lately, I‚Äôve had the pleasure of using Powershell to automate some of the basic tasks we do on our HPE 3PAR systems: creating volumes, adding them to volume sets, exporting them and so on.</p>
<p>Since my experience with REST APIs was rather limited it was quite daunting at first but once you get the hang of how REST works and the Invoke-RestMethod cmdlet it‚Äôs really not that bad.</p>
<p><em>Disclaimer: The examples below will vary somewhat in how I do certain things, simply because I had to learn all this from scratch. Hence, the first examples will sometimes do things ‚Äúless correct‚Äù than the later examples since this also was quite the learning curve for me.</em></p>
<p>The first step in doing anything with the REST API will always be to create a session key. If you‚Äôre not familiar with APIs, think of a session key as username and password combined into one string. You will need to add the session key to every REST call you do later on in order to authenticate yourself.<br>
To create a session key from powershell you can use the following line:</p>
<!-- raw HTML omitted -->
<p>This will store you session key in the $key variable which you will need to add to the header of future REST calls.</p>
<p>Keep in mind that each session key is valid for 15 minutes by default, but you should always delete it after each use.</p>
<p>To delete a session key you can use the following line, given that your key is still stored in $key:</p>
<!-- raw HTML omitted -->
<p>Now that you have your session key you can start to do some more interesting stuff, like creating a volume:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The above example will create a datastore named ‚Äú3parDatastore01‚Äù in the cpg named ‚ÄúSSD_r5‚Äù with 2TB of space and dedupe enabled. As you can see our session key is passed in the header as¬†X-HP3PAR-WSAPI-SessionKey.</p>
<p><em>If your well versed in JSON and powershell you can probably tell that I‚Äôm not üôÇ</em><br>
<em>The body you‚Äôre sending in the REST call is supposed to be formatted as a JSON object and in the above example I‚Äôm creating the JSON object manually by building it up as a string. In a later example I‚Äôll show a more ‚Äúcorrect‚Äù way to do it.</em></p>
<p>The next step will usually be to export the volume or to add it to a volume set. Let‚Äôs look at an example where I add a volume to an existing volume set:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><em>Again, I‚Äôm building the JSON object as a string here instead of doing it the correct way.</em></p>
<p>The above example will add the volume called ‚Äú3parDatastore01‚Äù (which we created in the previous example) to the existing volumeset called ‚ÄútestVVSet‚Äù. If you already have exported the volume set to a host or host set it is now available for the host(s) to use.</p>
<p>The next step for me now was to query the created volume since I had to find the wwn of the volume. There are two ways I have done this: By querying all volumes and by querying a single volume.<br>
To query all volumes you can use this line:</p>
<!-- raw HTML omitted -->
<p>To query a single volume you can use this line:</p>
<!-- raw HTML omitted -->
<p>You can also build a query directly in the uri you‚Äôre accessing by adding ?query=‚Äù<!-- raw HTML omitted -->‚Äù after /volumes. Here‚Äôs an example from HPE‚Äôs own guide:</p>
<!-- raw HTML omitted -->
<p>Of course, you can also do filtering in powershell if you‚Äôre more comfortable with that (I know I am) but then you will have wasted computing power on both the SAN and the machine you‚Äôre running powershell on üòâ</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>If you are not using volume sets and exporting those to hosts, the next logical step would be to export the newly created volume to a host or hostset. To export a volume to a single host you can do something like this:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><em>Notice the difference in the way I format the body? This is the more correct way to do it, creating a hashtable and converting it to JSON with ConvertTo-Json.</em><br>
<em>I also create the header before the Invoke-RestMethod line here.</em></p>
<p>The example above will export¬†3parDatastore01 to esx01 with a lun id of 255.</p>
<p>Lastly, I would like to provide you with an example on how we create our boot luns. This is an extract of a powershell function I wrote, in the original function there‚Äôs a lot more automation, error handling and logging but I removed it here for the sake of readability.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The key thing here is the policy (oneHost) that we set on the volume when we create it. This prevents the bootlun being exported to additional hosts.</p>
<p>Sources:<br>
HPE 3PAR API doc:¬†<!-- raw HTML omitted --><a href="http://h20564.www2.hpe.com/hpsc/doc/public/display?docId=c03606339">http://h20564.www2.hpe.com/hpsc/doc/public/display?docId=c03606339</a><!-- raw HTML omitted --></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/tags/3par/">3PAR</a></li>
      <li><a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/tags/boot-lun/">boot lun</a></li>
      <li><a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/tags/hpe-3par/">HPE 3PAR</a></li>
      <li><a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/tags/invoke-restmethod/">Invoke-RestMethod</a></li>
      <li><a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/tags/powershell/">Powershell</a></li>
      <li><a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net/tags/rest/">REST</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://blue-cliff-0fe9f2b03.3.azurestaticapps.net">PetterTech</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
